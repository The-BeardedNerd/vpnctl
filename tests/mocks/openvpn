#!/usr/bin/env bash
# Mock openvpn command for testing

# Parse arguments to handle daemon mode and PID file
daemon_mode=false
pid_file=""
config_file=""

while [[ $# -gt 0 ]]; do
    case $1 in
        --daemon)
            daemon_mode=true
            shift
            ;;
        --writepid)
            pid_file="$2"
            shift 2
            ;;
        --config)
            config_file="$2"
            shift 2
            ;;
        *)
            shift
            ;;
    esac
done

echo "Mock OpenVPN: daemon=$daemon_mode config=$config_file pid_file=$pid_file"

# If daemon mode and PID file specified, simulate creating PID file
if [[ "$daemon_mode" == "true" && -n "$pid_file" ]]; then
    # Start a background sleep process to simulate daemon
    sleep 3600 &
    daemon_pid=$!
    echo "$daemon_pid" > "$pid_file"
    echo "Mock OpenVPN: Created PID file $pid_file with PID $daemon_pid"
    # Disown the process so it continues running
    disown
fi

# Simulate successful startup
exit 0
